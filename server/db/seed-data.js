import mysql from 'mysql2/promise';
import bcrypt from 'bcryptjs';

// 创建数据库连接
const connection = await mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: '123456',
  database: 'gerenboke'
});

try {
  // 1. 首先创建一个管理员用户
  console.log('创建管理员用户...');
  const passwordHash = await bcrypt.hash('admin123', 10);
  
  // 检查用户是否已存在
  const [existingUsers] = await connection.query(
    `SELECT * FROM users WHERE username = '管理员'`
  );
  
  let userId;
  if (existingUsers.length === 0) {
    // 创建新用户
    const [result] = await connection.query(
      `INSERT INTO users (username, email, password_hash) VALUES (?, ?, ?)`,
      ['管理员', 'admin@example.com', passwordHash]
    );
    userId = result.insertId;
    console.log('管理员用户创建成功，ID:', userId);
  } else {
    // 使用现有用户
    userId = existingUsers[0].user_id;
    console.log('管理员用户已存在，ID:', userId);
  }
  
  // 2. 插入五篇指定的文章
  console.log('插入五篇文章...');
  
  const articles = [
    {
      title: '我的编程学习之路',
      content: '从零基础到成为一名开发者，分享我的编程学习历程、遇到的挑战和收获。包括如何选择第一门语言、学习资源推荐以及坚持学习的方法。\n\n学习编程是一段充满挑战但又非常充实的旅程。在这个过程中，我从对编程一无所知，到能够独立开发项目，积累了很多宝贵的经验和教训。\n\n首先，选择一门适合自己的编程语言非常重要。对于初学者来说，Python是一个不错的选择，它语法简洁，易于理解。当然，JavaScript也是一个很好的入门语言，特别是对于想要从事Web开发的人来说。\n\n其次，实践是学习编程的关键。理论知识固然重要，但只有通过实际项目的开发，才能真正掌握编程技能。可以从简单的小项目开始，逐渐挑战更复杂的项目。\n\n最后，保持学习的热情和毅力非常重要。技术更新迭代很快，需要不断学习新的知识和技能。同时，遇到问题时不要轻易放弃，要学会利用搜索引擎和社区资源来解决问题。\n\n希望我的分享能够对正在学习编程的你有所帮助，祝你在编程之路上越走越远！'
    },
    {
      title: '最适合编程时听的音乐推荐',
      content: '编程需要专注，好的音乐可以提高效率。分享我的编程音乐清单，包括纯音乐、电子音乐、古典音乐等不同类型，以及音乐对编程状态的影响。\n\n编程是一项需要高度专注的工作，而合适的音乐可以帮助我们进入专注状态，提高工作效率。以下是我在编程时经常听的音乐类型和具体推荐：\n\n1. 纯音乐\n   - 推荐艺术家：Ludovico Einaudi、Yiruma、Max Richter\n   - 推荐专辑：《Una Mattina》、《River Flows in You》、《Memoryhouse》\n   - 特点：节奏平缓，旋律优美，不会分散注意力\n\n2. 电子音乐\n   - 推荐艺术家：Tycho、Bonobo、Emancipator\n   - 推荐专辑：《Epoch》、《Migration》、《Baralku》\n   - 特点：节奏明快，有活力，适合需要创造力的编程任务\n\n3. 古典音乐\n   - 推荐作曲家：巴赫、莫扎特、贝多芬\n   - 推荐作品：《哥德堡变奏曲》、《第40号交响曲》、《月光奏鸣曲》\n   - 特点：结构严谨，有助于逻辑思维\n\n4. 环境音乐\n   - 推荐类型：雨声、白噪音、森林音效\n   - 推荐平台：Rainy Mood、Noisli\n   - 特点：屏蔽外界噪音，创造安静的工作环境\n\n当然，每个人对音乐的喜好不同，最重要的是找到适合自己的音乐类型。有些人甚至喜欢在完全安静的环境中编程，这也是完全可以的。\n\n希望这些推荐能够帮助你找到适合编程时听的音乐，提高你的编程效率！'
    },
    {
      title: '如何高效学习新技术',
      content: '技术更新迭代快，掌握高效学习方法至关重要。本文介绍如何快速学习新技术，包括文档阅读技巧、实践项目选择、社区参与等实用建议。\n\n在科技快速发展的时代，技术更新迭代的速度越来越快。作为一名开发者，掌握高效学习新技术的方法至关重要。以下是我总结的一些高效学习新技术的方法：\n\n1. 设定明确的学习目标\n   - 在学习新技术之前，先明确自己的学习目标\n   - 是为了解决特定问题，还是为了提升自己的技能栈\n   - 明确的目标有助于保持学习的动力和方向\n\n2. 从官方文档开始\n   - 官方文档是学习新技术的最佳资源\n   - 先快速浏览文档，了解技术的整体架构和核心概念\n   - 然后深入学习关键模块和API\n\n3. 实践出真知\n   - 通过实际项目来学习新技术是最有效的方法\n   - 可以从简单的示例开始，逐渐扩展功能\n   - 遇到问题时，尝试自己解决，这有助于加深理解\n\n4. 参与社区\n   - 加入技术社区，与其他开发者交流\n   - 关注相关的GitHub仓库、论坛和社交媒体\n   - 参与讨论和贡献，提升自己的影响力\n\n5. 总结和分享\n   - 学习过程中，及时总结所学的知识\n   - 可以写博客、做演讲或录制视频\n   - 分享的过程也是巩固知识的过程\n\n6. 保持持续学习的习惯\n   - 技术更新很快，需要保持持续学习的习惯\n   - 可以订阅技术博客、 podcasts或YouTube频道\n   - 定期参加技术会议和研讨会\n\n通过以上方法，我相信你可以更高效地学习新技术，保持自己的竞争力。记住，学习是一个持续的过程，需要不断努力和实践。'
    },
    {
      title: '技术人如何平衡学习与生活',
      content: '技术人面临持续学习的压力，如何平衡学习、工作和生活？分享我的时间管理方法、学习计划制定以及保持身心健康的秘诀。\n\n作为一名技术人，我们面临着持续学习的压力。一方面，我们需要完成日常的工作任务；另一方面，我们需要不断学习新技术，提升自己的技能。如何在学习、工作和生活之间找到平衡，成为了很多技术人面临的挑战。以下是我在实践中总结的一些经验和方法：\n\n1. 时间管理\n   - 使用日历和待办事项应用来规划时间\n   - 设定明确的工作时间和学习时间，避免互相干扰\n   - 学会拒绝不必要的任务，专注于重要的事情\n   - 使用番茄工作法等时间管理技巧来提高效率\n\n2. 学习计划\n   - 制定合理的学习计划，避免过度学习\n   - 将学习目标分解为小的任务，逐步完成\n   - 定期回顾和调整学习计划\n   - 保持学习的趣味性，避免枯燥\n\n3. 工作效率\n   - 在工作时间内提高效率，避免加班\n   - 学会自动化重复的任务\n   - 与团队成员保持良好的沟通，避免误解和返工\n   - 定期总结工作经验，提高工作技能\n\n4. 身心健康\n   - 保持充足的睡眠，这是提高效率的基础\n   - 定期锻炼，保持身体健康\n   - 培养兴趣爱好，放松身心\n   - 与家人和朋友保持联系，维护良好的人际关系\n\n5. 平衡心态\n   - 接受自己不可能掌握所有的技术\n   - 不要过度焦虑，保持平和的心态\n   - 学会享受学习和工作的过程\n   - 设定合理的期望，避免完美主义\n\n平衡学习、工作和生活是一个持续的过程，需要不断调整和实践。希望以上经验能够对你有所帮助，找到适合自己的平衡方式。'
    },
    {
      title: '学习编程改变我的5个思维方式',
      content: '编程不仅仅是一门技能，更是一种思维方式。分享学习编程后我的思维转变，包括逻辑思维、问题分解能力、调试思维等方面的提升。\n\n学习编程不仅仅是掌握一门技能，更是培养一种思维方式。在学习编程的过程中，我发现自己的思维方式发生了很大的变化。以下是学习编程改变我的5个思维方式：\n\n1. 逻辑思维\n   - 编程需要严谨的逻辑思维\n   - 学会了如何分析问题，找出因果关系\n   - 提高了判断和推理能力\n\n2. 问题分解能力\n   - 将复杂的问题分解为小的、可解决的子问题\n   - 学会了从整体到局部的分析方法\n   - 提高了处理复杂问题的能力\n\n3. 调试思维\n   - 学会了如何定位和解决问题\n   - 提高了排查错误的能力\n   - 培养了耐心和细心\n\n4. 抽象思维\n   - 学会了如何抽象出问题的本质\n   - 提高了建模和设计能力\n   - 能够更好地理解复杂系统\n\n5. 系统思维\n   - 学会了从系统的角度思考问题\n   - 理解了各个组件之间的关系和影响\n   - 提高了设计和架构能力\n\n这些思维方式的改变不仅对我的编程工作有帮助，也对我的日常生活产生了积极的影响。编程教会了我如何更有条理地思考问题，如何更高效地解决问题。\n\n如果你还没有开始学习编程，我鼓励你尝试一下。学习编程不仅可以掌握一门实用的技能，还可以改变你的思维方式，提高你的整体能力。'
    }
  ];
  
  // 插入文章
  for (const article of articles) {
    // 检查文章是否已存在
    const [existingPosts] = await connection.query(
      `SELECT * FROM posts WHERE title = ?`,
      [article.title]
    );
    
    if (existingPosts.length === 0) {
      await connection.query(
        `INSERT INTO posts (title, content, author_id) VALUES (?, ?, ?)`,
        [article.title, article.content, userId]
      );
      console.log(`文章插入成功: ${article.title}`);
    } else {
      console.log(`文章已存在: ${article.title}`);
    }
  }
  
  console.log('数据插入完成！');
} catch (error) {
  console.error('数据插入失败:', error);
} finally {
  // 关闭连接
  await connection.end();
}